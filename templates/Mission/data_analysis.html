{% extends 'base.html' %}
{% load static %}

{% block content %}
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://cdn.jsdelivr.net/npm/bs-custom-file-input@1.3.4/dist/bs-custom-file-input.min.js"></script>

    <div class="container my-5">
        <h1 class="text-center mb-5">数据分析</h1>
        <form id="upload-form" method="post" enctype="multipart/form-data" class="d-flex justify-content-center">
            {% csrf_token %}
            <div class="input-group mb-3">
                <div class="custom-file">
                    <input type="file" class="custom-file-input" id="inputGroupFile01" name="excel_file"
                           aria-describedby="inputGroupFileAddon01">
                    <label class="custom-file-label" for="inputGroupFile01">选择文件</label>
                </div>
                <div class="input-group-append">
                    <button type="submit" class="btn btn-primary">导入</button>
                </div>
            </div>
        </form>
    </div>

    <div class="modal fade" id="processingModal" tabindex="-1" role="dialog" aria-labelledby="processingModalLabel"
         aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="processingModalLabel">正在处理...</h5>
                </div>
                <div class="modal-body">
                    <div class="progress">
                        <div id="animatedProgressBar" class="progress-bar progress-bar-striped" role="progressbar"
                             aria-valuenow="75" aria-valuemin="0" aria-valuemax="100" style="width: 50%"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>

    <script>
        $(document).ready(function () {
            bsCustomFileInput.init();

            $('#upload-form').on('submit', function (e) {
                e.preventDefault();

                $('#processingModal').modal({backdrop: 'static', keyboard: false});

                animateProgressBar();

                setTimeout(function () {
                    $('#upload-form').unbind('submit').submit();
                }, 500);
            });

            function animateProgressBar() {
                var colors = ['success', 'danger', 'warning', 'info'];
                var currentColorIndex = 0;
                setInterval(function () {
                    var $progressBar = $('#animatedProgressBar');
                    $progressBar.removeClass('bg-' + colors[currentColorIndex]);
                    currentColorIndex = (currentColorIndex + 1) % colors.length;
                    $progressBar.addClass('bg-' + colors[currentColorIndex]);

                    $progressBar.css('width', (Math.random() * 50 + 50) + '%');
                }, 500);
            }
        });
    </script>
{% endblock %}
