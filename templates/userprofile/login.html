{% load static %}

<head>
    {% if user.is_authenticated %}
        <script>
            function user_delete() {
                var r = confirm("Wanna delete this user?");
                if (r == true) {
                    window.location = '{% url "userprofile:delete" user.id %}';
                }
            }
        </script>
    {% endif %}
</head>

                <button id="registered_users_button" class="btn btn-info">已注册用户</button>



<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>login</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="robots" content="all,follow">
    <link rel="stylesheet" href="{% static 'bootstrap/css/bootstrap1.css' %}">
    <!-- Add animate.css -->
    <link rel="stylesheet" href="{% static 'css/animate.css' %}">
    <link rel="stylesheet" href="{% static 'css/style1.css' %}">
    <style>
        #registered_users_area {
            display: none;
            position: fixed;
            z-index: 1000;
            width: 15%; /* 修改宽度为80%，让它在屏幕中心显示 */
            height: 80%; /* 修改高度为80%，让它在屏幕中心显示 */
            top: -100%; /* 初始状态设置在屏幕外 */
            left: 50%; /* 使其水平居中 */
            transform: translate(-50%, -50%); /* 修正由于定位导致的偏移 */
            background-color: rgba(0, 0, 0, 0.5); /* 设置背景颜色为半透明的黑色，以增加质感 */
            border-radius: 10px; /* 添加圆角 */
            padding: 20px; /* 添加内边距 */
            color: #fff; /* 设置文字颜色为白色 */
            box-sizing: border-box; /* 确保宽度和高度包括内边距和边框 */
            opacity: 0;
            transition: top 1s, opacity 1s;
        }


        #user_list {
            height: calc(100% - 40px); /* 减去标题和一些额外的空间 */
            overflow-y: auto; /* 添加垂直滚动条 */
            background-color: rgba(255, 255, 255, 0.01); /* 设置背景颜色为半透明的白色，使其在黑色背景上可见 */
            border-radius: 10px; /* 添加圆角 */
            padding: 10px; /* 添加一些内边距 */
            box-sizing: border-box; /* 确保宽度和高度包括内边距和边框 */
            color: #000; /* 设置文字颜色为黑色 */
        }

        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        #chart-container {
            height: 500px;
            width: 500px;
            margin-right: 50px;
        }

        .card {
            width: 350px;
            background-color: rgba(255, 255, 255, 0.8);
            border: none;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1), 0 1px 3px rgba(0, 0, 0, 0.08);
        }

        .card-body {
            padding: 30px;
        }

        .form-control {
            border: none;
            border-bottom: 1px solid #ddd;
            border-radius: 0;
            box-shadow: none;
        }

        .form-control:focus {
            border-bottom: 1px solid #007BFF;
            box-shadow: none;
            outline: none;
        }

        .btn-primary {
            background-color: #007BFF;
            border: none;
            border-radius: 20px;
            padding: 5px 30px;
            font-weight: 600;
        }

        .signup {
            color: #007BFF;
            text-decoration: none;
        }

        .signup:hover {
            color: #0056b3;
            text-decoration: none;
        }
    </style>

</head>


<body>

<div id="registered_users_area" style="display: none;">
    <h5 class="title">已注册用户</h5>
    <div id="user_list"></div>
</div>


<div class="container">
    <div id="chart-container"></div>

    <div class="card">
        <div class="card-body">
            <form method="post" action="." id='loginform'>
                {% csrf_token %}
                <div class="form-floating mb-3">
                    <input class="form-control" id="username" name='username' data-msg="请输入用户名"
                           placeholder="用户名" type="text" data-sb-validations="required"/>
                    <div class="invalid-feedback" data-sb-feedback="username:required">A name is required.</div>
                </div>

                <div class="form-floating mb-3">
                    <input class="form-control" id="password" name='password' data-msg="请输入密码"
                           placeholder="密码" type="password" data-sb-validations="required"/>
                    <div class="invalid-feedback" data-sb-feedback="password:required">A password is required.</div>
                </div>

                <div class="d-flex justify-content-between mb-3">
                    <button id="login" type="submit" class="btn btn-primary">登录</button>
                </div>

                <small>没有账号?</small><a href='{% url "userprofile:register" %}'
                                           class="signup">注册</a>
            </form>
        </div>
    </div>
</div>


<!-- JavaScript files-->
<script src="{% static 'bootstrap/echarts.min.js' %}"></script>
<script src="{% static 'jquery/index1.js' %}"></script>
<script src="{% static 'jquery/jquery1.js' %}"></script>
<script src="{% static 'bootstrap/bootstrap1.js' %}"></script>
<script src="../../static/bootstrap/js/jquery.validate.min.js"></script><!--表单验证-->
<!-- Main File-->
<script src="../../static/bootstrap/js/front.js"></script>
<script>
    $('#registered_users_button').click(function () {
        if ($('#registered_users_area').css('display') === 'none') {
            // 弹出框
            $('#registered_users_area').css('display', 'block');
            setTimeout(function () {
                $('#registered_users_area').css({
                    'top': '50%',
                    'opacity': '1'
                });
            }, 100);

            // 请求并显示用户列表
            $.ajax({
                url: '/userprofile/api/registered_users/',  // 修改为你的API URL
                method: 'GET',
                success: function (data) {
                    console.log('Data received: ', data);
                    // 清空用户列表内容
                    $('#user_list').empty();

                    // 循环遍历每一个用户，将其添加到用户列表中
                    $.each(data.users, function (index, user) {
                        console.log(user);  // 添加这行来查看user对象的内容
                        $('#user_list').append('<p>' + user.username + '</p>');
                        console.log('User added: ' + user.username);
                    });
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log('Ajax request failed: ', textStatus, errorThrown);
                }
            });
        } else {
            // 隐藏框
            $('#registered_users_area').css({
                'top': '-100%',
                'opacity': '0'
            });
            setTimeout(function () {
                $('#registered_users_area').css('display', 'none');
            }, 1000);
        }
    });


</script>
</body>

</html>
